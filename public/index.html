<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>字体压缩服务</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <h1>字体压缩服务</h1>
    
    <div class="container">
        <form id="compressForm">
            <div class="form-group">
                <label for="fontFile">上传字体文件（TTF/OTF格式）：</label>
                <input type="file" id="fontFile" name="font" accept=".ttf,.otf" required>
                <div id="fileSizeWarning" class="file-size-warning">
                    文件超过4.5MB (Vercel Hobby套餐限制)，处理可能会失败。建议升级套餐或采用Blob Store方案处理大文件。
                </div>
                <div id="uploadProgress" class="upload-progress-container">
                    <div class="progress-bar">
                        <div id="progressBarFill" class="progress-bar-fill"></div>
                    </div>
                    <div id="progressText" class="progress-text">0%</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="textInput">需要保留的文字：</label>
                <textarea id="textInput" name="text" placeholder="输入需要保留的文字，如网站上的所有文字内容..." required></textarea>
                
                <div class="preset-chars">
                    <h4>常用字符集（可多选）：</h4>
                    <div class="preset-options">
                        <div class="checkbox-item">
                            <input type="checkbox" id="chinese-numbers" class="preset-checkbox" data-id="cn">
                            <label for="chinese-numbers">中文数字</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="arabic-numbers" class="preset-checkbox" data-id="an">
                            <label for="arabic-numbers">阿拉伯数字</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="english-letters" class="preset-checkbox" data-id="el">
                            <label for="english-letters">英文字母</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="chinese-punctuation" class="preset-checkbox" data-id="cp">
                            <label for="chinese-punctuation">中文标点</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="english-punctuation" class="preset-checkbox" data-id="ep">
                            <label for="english-punctuation">英文符号</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="common-chinese" class="preset-checkbox" data-id="cc">
                            <label for="common-chinese">常用汉字500</label>
                        </div>
                    </div>
                    <button type="button" id="addSelectedChars" class="add-chars-btn">添加所选字符集</button>
                </div>
            </div>
            
            <button type="submit" id="submitBtn">压缩字体</button>
        </form>
        
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>正在处理中，请稍候...</p>
        </div>
        
        <div id="successMessage" class="success-message"></div>
        <div id="errorMessage" class="error-message"></div>
    </div>
    
    <div class="tips">
        <h3>使用提示</h3>
        <ul>
            <li>只支持TTF和OTF格式的字体文件</li>
            <li>建议字体文件大小不要超过4.5MB (Vercel Hobby套餐限制)，否则可能处理失败。如需处理更大文件，请考虑升级套餐或使用Blob Store方案。</li>
            <li>文字输入框中填入需要保留的所有文字，如网站上的全部文字内容</li>
            <li>处理完成后，浏览器会自动下载压缩后的字体文件</li>
            <li>字体压缩是基于文字子集化，仅保留您指定的文字对应的字形</li>
        </ul>
    </div>

    <div class="api-docs">
        <h3>API 参考</h3>
        <p>本部分为希望通过 API 端点直接集成字体压缩服务的开发者提供详细信息。<strong>注意：此 API 配合客户端直接上传文件至 Vercel Blob Store 使用。</strong></p>

        <h4>端点 (Endpoint)</h4>
        <p><code>POST</code> <code>/api/compress</code></p>

        <h4>请求 (Request)</h4>
        <p>请求头应包含 <code>Content-Type: application/json</code>。请求体为一个 JSON 对象，包含以下字段：</p>
        <h5>请求体 JSON 参数:</h5>
        <ul>
            <li>
                <strong><code>blobUrl</code></strong> (string, 必需):
                字体文件在 Vercel Blob Store 中的完整 URL。客户端应先将字体文件上传到 Blob Store，然后将返回的 URL 传递给此参数。
            </li>
            <li>
                <strong><code>text</code></strong> (string, 必需):
                一个包含所有应在压缩字体中保留的字符的字符串。
            </li>
        </ul>

        <h4>响应 (Response)</h4>
        <h5>成功 (<code>200 OK</code>):</h5>
        <p>压缩后的字体文件以二进制流的形式返回。响应头将包含以下信息：</p>
        <ul>
            <li><code>Content-Type</code>: 字体对应的MIME类型 (例如, <code>application/font-ttf</code>, <code>application/font-woff2</code>)。</li>
            <li><code>Content-Disposition</code>: <code>attachment; filename="compressed-your-font-name.ext"</code>，建议下载时的文件名。</li>
            <li><code>Content-Length</code>: 压缩后字体文件的大小 (字节)。</li>
        </ul>
        <p><em>(未来增强：成功时也可能返回一个包含压缩后文件在 Blob Store 中的 URL 的 JSON 对象，例如 <code>{"compressedBlobUrl": "..."}</code>，具体取决于后端的实现策略。)</em></p>
        <h5>错误 (<code>4xx</code> 或 <code>5xx</code>):</h5>
        <p>返回描述错误的 JSON 对象。例如：</p>
        <div class="code-block">
            <pre><code>{
  "error": "这里是具体的错误描述信息"
}</code></pre>
        </div>
        <p>常见的错误码包括：</p>
        <ul>
            <li><code>400 Bad Request</code>: 缺少必需参数 (<code>blobUrl</code> 或 <code>text</code>)，或 `blobUrl` 无效/无法访问。</li>
            <li><code>405 Method Not Allowed</code>: 请求方法不是 POST。</li>
            <li><code>500 Internal Server Error</code>: 处理过程中发生意外错误 (例如从 Blob Store 下载文件失败, Fontmin 内部错误等)。</li>
        </ul>
    </div>

    <script type="module" src="assets/bundle.js"></script>
</body>
</html> 